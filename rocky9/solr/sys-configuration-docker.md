ì•„ë˜ëŠ” **Docker ê¸°ë°˜ SolrCloud ìµœì†Œ í´ëŸ¬ìŠ¤í„° êµ¬ì„± ì„¤ëª…ì„œ**ì…ë‹ˆë‹¤.
**Persistent Volume ì‚¬ìš©**, **ë¬¼ë¦¬ ì„œë²„-ì»¨í…Œì´ë„ˆ ê´€ê³„**, **Mermaid êµ¬ì¡°ë„**ì…ë‹ˆë‹¤.

---

# ğŸ³ Docker ê¸°ë°˜ SolrCloud ìµœì†Œ í´ëŸ¬ìŠ¤í„° êµ¬ì„± ë¬¸ì„œ

Apache SolrCloudë¥¼ Docker ê¸°ë°˜ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê±°ë‚˜ ê°œë°œìš©ìœ¼ë¡œ êµ¬ì„±í•  ê²½ìš°, ë‹¤ìŒê³¼ ê°™ì€ **ìµœì†Œ êµ¬ì„± í´ëŸ¬ìŠ¤í„°**ë¡œ ì‹œì‘í•˜ëŠ” ê²ƒì´ ìœ ìš©í•©ë‹ˆë‹¤.

ì´ ë¬¸ì„œì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ í•µì‹¬ ì‚¬í•­ì„ ë‹¤ë£¹ë‹ˆë‹¤:

* SolrCloud ê¸°ë³¸ êµ¬ì¡° (shard + replica)
* Docker ì»¨í…Œì´ë„ˆ ë°°í¬ ëª¨ë¸
* **Persistent Volume**ì„ í†µí•œ ë°ì´í„° ë³´ì¡´
* ì‹œê°ì  êµ¬ì¡°ë„ (Mermaid)

---

## ğŸ“Š í´ëŸ¬ìŠ¤í„° ì•„í‚¤í…ì²˜ ê°œìš”

* Zookeeper 1ê°œ (ë‹¨ì¼ ë…¸ë“œ, í…ŒìŠ¤íŠ¸ìš©)
* Solr ì¸ìŠ¤í„´ìŠ¤ 4ê°œ (shard 2ê°œ + ê° replica 1ê°œ)
* ë¬¼ë¦¬ ì„œë²„ 2ëŒ€: Server A, Server B
* ëª¨ë“  Solr ì»¨í…Œì´ë„ˆëŠ” **Docker ê¸°ë°˜ìœ¼ë¡œ ë°°í¬**
* ê° ì»¨í…Œì´ë„ˆëŠ” ë…ë¦½ì ì¸ **Persistent Volume**ì„ ë§ˆìš´íŠ¸í•˜ì—¬ ë°ì´í„° ë³´ì¡´

---

## ğŸ–¼ Mermaid êµ¬ì„±ë„

```mermaid
flowchart TB

  %% í´ë¼ì´ì–¸íŠ¸
  Client["ğŸŒ Client / Load Balancer"]

  %% Zookeeper ë‹¨ì¼ ë…¸ë“œ (ì»¨í…Œì´ë„ˆ)
  subgraph "ğŸ§­ Zookeeper (Docker)"
    ZK["ğŸ¾ zookeeper<br>on Server A"]
  end

  %% Server A (2ê°œì˜ Solr ì»¨í…Œì´ë„ˆ)
  subgraph "ğŸ–¥ Server A"
    A1["ğŸ§± solr-a1 (Docker)<br>shard1<br>/opt/solr-a1_home"]
    A2["ğŸ§± solr-a2 (Docker)<br>shard2<br>/opt/solr-a2_home"]
  end

  %% Server B (2ê°œì˜ Solr ì»¨í…Œì´ë„ˆ)
  subgraph "ğŸ–¥ Server B"
    B1["ğŸ§± solr-b1 (Docker)<br>shard1 replica<br>/opt/solr-b1_home"]
    B2["ğŸ§± solr-b2 (Docker)<br>shard2 replica<br>/opt/solr-b2_home"]
  end

  %% í´ëŸ¬ìŠ¤í„° ì—°ê²°
  ZK --> A1
  ZK --> A2
  ZK --> B1
  ZK --> B2

  %% í´ë¼ì´ì–¸íŠ¸ ì ‘ì† ê²½ë¡œ
  Client --> A1
  Client --> A2
  Client --> B1
  Client --> B2
```

---

## ğŸ“¦ êµ¬ì„± ìš”ì•½

| í•­ëª©                       | ë‚´ìš©                          |
| ------------------------ | --------------------------- |
| ğŸ§­ Zookeeper             | ë‹¨ì¼ ë…¸ë“œ ì»¨í…Œì´ë„ˆ (Server Aì— ìœ„ì¹˜)   |
| ğŸ§± Solr ì»¨í…Œì´ë„ˆ             | ì´ 4ê°œ (ì„œë²„ë‹¹ 2ê°œì”©), Cloud ëª¨ë“œ ì‹¤í–‰ |
| ğŸ–¥ ë¬¼ë¦¬ ì„œë²„ ìˆ˜               | 2ëŒ€ (Server A, Server B)     |
| ğŸ§  ë°ì´í„° êµ¬ì¡°                | shard 2ê°œ + ê° replica 1ê°œ     |
| ğŸ”„ ë„¤íŠ¸ì›Œí¬                  | Docker bridge ë˜ëŠ” overlay    |
| ğŸ“Œ **Persistent Volume** | ì»¨í…Œì´ë„ˆë§ˆë‹¤ ë…ë¦½ëœ host ë””ìŠ¤í¬ ë§ˆìš´íŠ¸ í•„ìˆ˜  |

---

## ğŸ§± ì‹¤ì œ ì»¨í…Œì´ë„ˆ êµ¬ì„± ì˜ˆì‹œ

| ì»¨í…Œì´ë„ˆ ì´ë¦„   | ì„œë²„ | ì—­í•              | í¬íŠ¸ ë§¤í•‘     | Persistent Volume ê²½ë¡œ |
| --------- | -- | -------------- | --------- | -------------------- |
| zookeeper | A  | í´ëŸ¬ìŠ¤í„° ë©”íƒ€ ê´€ë¦¬     | 2181:2181 | `/opt/zk-data`       |
| solr-a1   | A  | shard1         | 8983:8983 | `/opt/solr-a1_home`  |
| solr-a2   | A  | shard2         | 8984:8983 | `/opt/solr-a2_home`  |
| solr-b1   | B  | shard1 replica | 8983:8983 | `/opt/solr-b1_home`  |
| solr-b2   | B  | shard2 replica | 8984:8983 | `/opt/solr-b2_home`  |

---

## ğŸ’¾ Persistent Volumeì´ í•„ìš”í•œ ì´ìœ 

Docker ì»¨í…Œì´ë„ˆëŠ” ê¸°ë³¸ì ìœ¼ë¡œ íœ˜ë°œì„±ì´ë©°, **ì¬ì‹œì‘ ì‹œ ëª¨ë“  ë°ì´í„°ê°€ ìœ ì‹¤**ë©ë‹ˆë‹¤.
SolrëŠ” ë‹¤ìŒ ë°ì´í„°ë¥¼ ë””ìŠ¤í¬ì— ì €ì¥í•©ë‹ˆë‹¤:

* ìƒ‰ì¸ëœ ë¬¸ì„œ (index)
* Core ì„¤ì •
* Schema ë° Collection ì •ë³´
* íŠ¸ëœì­ì…˜ ë¡œê·¸ ë° ìš´ì˜ ë¡œê·¸

ë”°ë¼ì„œ ë°˜ë“œì‹œ **í˜¸ìŠ¤íŠ¸ ë””ìŠ¤í¬ë¥¼ ë§ˆìš´íŠ¸í•˜ì—¬ ì˜êµ¬ ìŠ¤í† ë¦¬ì§€ë¥¼ êµ¬ì„±**í•´ì•¼ í•©ë‹ˆë‹¤.

### ë§ˆìš´íŠ¸ ì˜ˆì‹œ (`docker run` ëª…ë ¹)

```bash
docker run -d \
  --name solr-a1 \
  -p 8983:8983 \
  -v /opt/solr-a1_home:/var/solr \
  solr:8.11 \
  solr start -c -z zookeeper:2181
```

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡° ì˜ˆì‹œ

```bash
/opt/
â”œâ”€â”€ solr-a1_home/
â”‚   â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ logs/
â”‚   â””â”€â”€ core1/
â”œâ”€â”€ solr-a2_home/
â”œâ”€â”€ solr-b1_home/
â”œâ”€â”€ solr-b2_home/
â”œâ”€â”€ zk-data/
```

---

## âœ… ê²°ë¡ 

* ì´ êµ¬ì¡°ëŠ” **SolrCloudì˜ ìµœì†Œ ë™ì‘ ëª¨ë¸ì„ Docker ê¸°ë°˜ìœ¼ë¡œ ì¬í˜„**í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.
* ê° ì»¨í…Œì´ë„ˆëŠ” ë°˜ë“œì‹œ **Persistent Volume**ì„ í†µí•´ ë°ì´í„° ì†ì‹¤ì„ ë°©ì§€í•´ì•¼ í•˜ë©°,
* í´ëŸ¬ìŠ¤í„° í™•ì¥ ì‹œì—ë„ ë™ì¼í•œ êµ¬ì¡°ë¥¼ ë”°ë¼ ìˆ˜í‰ í™•ì¥ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## ğŸ“Œ ë‹¤ìŒ ë‹¨ê³„

ì´ êµ¬ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ:

* `docker-compose.yml` ìë™ ë°°í¬ í…œí”Œë¦¿
* SolrCloud ì»¬ë ‰ì…˜ ìƒì„± ìŠ¤í¬ë¦½íŠ¸
* Zookeeper 3ë…¸ë“œ ê³ ê°€ìš©ì„± êµ¬ì„±
* Prometheus ê¸°ë°˜ ëª¨ë‹ˆí„°ë§ ì—°ë™

ë“±ì„ í™•ì¥ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
